# elm-codegen **[WIP]**

Generate and maintain Elm module file!

[![oclif](https://img.shields.io/badge/cli-oclif-brightgreen.svg)](https://oclif.io)
[![Version](https://img.shields.io/npm/v/elm-codegen.svg)](https://npmjs.org/package/elm-codegen)
[![CircleCI](https://circleci.com/gh/ymtszw/elm-codegen/tree/master.svg?style=shield)](https://circleci.com/gh/ymtszw/elm-codegen/tree/master)
[![Downloads/week](https://img.shields.io/npm/dw/elm-codegen.svg)](https://npmjs.org/package/elm-codegen)
[![License](https://img.shields.io/npm/l/elm-codegen.svg)](https://github.com/ymtszw/elm-codegen/blob/master/package.json)

Is is a tool built specifically for generating and maintaining Elm modules with data types such that:

- Record-based
- Opaque-typed
- Builder-pattern-adopting

Generated files (`src/Example/Data.elm`) look like below:

```elm
module Example.Data exposing
    ( Data, Id, new
    , getId, getName, getFavorites
    , setId, setName, setFavorites
    )

{-| Example Data type module.

[[GENERATED BY elm-codegen; DO NOT MANUALLY EDIT BELOW!]]

@docs Data, Id, new
@docs getId, getName, getFavorites
@docs setId, setName, setFavorites

[[GENERATED BY elm-codegen; DO NOT MANUALLY EDIT ABOVE!]]

-}

import Favorite exposing (Favorite)
import Id

-- GENERATED BY elm-codegen; DO NOT MANUALLY EDIT BELOW!
-- Template can be found here; https://github.com/ymtszw/elm-codegen/src/master.elm.hbs
-- Data source can be found here: https://github.com/ymtszw/elm-codegen/examples/Example/Data.schema.json

type Data
    = Data DataRecord

type alias DataRecord =
    { id : Id
    , name : String
    , favorites : List Favorite
    }

type alias Id =
    Id.Id String Data

new : Data
new =
    Data
        { id = Id.from "dummy"
        , name = "dummy"
        , favorites = []
        }

getId : Data -> Id
getId (Data record) =
    record.id

getName : Data -> String
getName (Data record) =
    record.name

getFavorites : Data -> List Favorite
getFavorites (Data record) =
    record.favorites


setId : Id -> Data -> Data
setId (Data record) =
    Data { record | id = value }


setName : String -> Data -> Data
setName (Data record) =
    Data { record | name = value }


setFavorites : List Favorite -> Data -> Data
setFavorites (Data record) =
    Data { record | favorites = value }


-- GENERATED BY elm-codegen; DO NOT MANUALLY EDIT ABOVE!
```

And schema files (`src/Example/Data.schema.json`) look like below:

```json
{
  "description": "Example Data type module.",
  "exposedTypes": ["Data", "Id"],
  "imports": [
    { "module": "Favorite", "exposing": ["Favorite"] },
    { "module": "id" }
  ],
  "mainType": {
    "name": "Data",
    "opaque": true,
    "fields": [
      { "name": "id", "type": "Id", "default": "Id.from \"dummy\"" },
      { "name": "name", "type": "String", "default": "\"dummy\"" },
      { "name": "favorites", "type": "List Favorite", "default": "[]" }
    ]
  },
  "auxiliaryTypes": [
    { "name": "Id", "alias": true, "type": "Id.Id String Data" }
  ]
}
```

Then, you can freely edit other places in resultant files,
and even, re-generate (update) files already generated (and edited) when you update your schema files!

# Features and TODO

- [ ] Generate main and auxiliary type definitions (a main type must be record-based)
- [ ] Generate constructor (`new`), getters and setters
- [ ] Generate module name, imports, exports, and module doc
- [ ] Generate JSON codecs (future plan)

# Usage

1. Install CLI globally.

   ```sh
   npm install -g elm-codegen
   ```

2. Prepare schema files in your Elm project. (They live alongside with generated source files)

   ```sh
   cd your/project/directory
   mkdir -p src/Example
   # Edit and save src/Example/Data.schema.json
   ```

3. Generate!

   ```sh
   elm-codegen
   cat src/Example/Data.elm
   # module Example.Data exposing
   #     (Data, Id, new
   # (snip)
   ```

4. If you edit your schema file(s), just run `elm-codegen` again!

# Remarks

- In the above examples, [elm-id](https://github.com/Punie/elm-id) (phantom type ID) is used.
  - This is a really strong and useful pattern which author prefers, but not a requirement of `elm-codegen`
- JSON codecs are desirable but left as future addition. Needs careful research before implementing.
- You MAY choose to expose internal record (`"opaque": false`), although be mindful about consequences.
